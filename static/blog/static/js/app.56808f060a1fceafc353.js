(function(e){function t(t){for(var c,o,s=t[0],l=t[1],i=t[2],g=0,d=[];g<s.length;g++)o=s[g],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&d.push(n[o][0]),n[o]=0;for(c in l)Object.prototype.hasOwnProperty.call(l,c)&&(e[c]=l[c]);u&&u(t);while(d.length)d.shift()();return r.push.apply(r,i||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],c=!0,s=1;s<a.length;s++){var l=a[s];0!==n[l]&&(c=!1)}c&&(r.splice(t--,1),e=o(o.s=a[0]))}return e}var c={},n={app:0},r=[];function o(t){if(c[t])return c[t].exports;var a=c[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=c,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)o.d(a,c,function(t){return e[t]}.bind(null,c));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/blog/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var i=0;i<s.length;i++)t(s[i]);var u=l;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"036b":function(e,t,a){"use strict";a("77b7")},"2a28":function(e,t,a){},"343b":function(e,t,a){},3895:function(e,t,a){},4076:function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("88a7"),a("271a"),a("5494");var c=a("7a23");function n(e,t,a,n,r,o){const s=Object(c["A"])("router-view");return Object(c["v"])(),Object(c["d"])(s)}var r={name:"App"},o=(a("fa19"),a("6b0d")),s=a.n(o);const l=s()(r,[["render",n]]);var i=l,u=a("6605");function g(e,t,a,n,r,o){const s=Object(c["A"])("BlogHeader"),l=Object(c["A"])("ArticleList"),i=Object(c["A"])("BlogFooter");return Object(c["v"])(),Object(c["f"])(c["a"],null,[Object(c["j"])(s),Object(c["j"])(l),Object(c["j"])(i)],64)}var d=a("ddf2"),b=a.n(d);const p={id:"header"},j={class:"grid"},O={class:"title-container"},m={class:"login"},v={class:"nav-links"},h={class:"right-links"},f={key:0},y={class:"dropdown"},k={class:"dropbtn"},w={class:"dropdown-content"},I={key:1};function C(e,t,a,n,r,o){const s=Object(c["A"])("router-link");return Object(c["v"])(),Object(c["f"])("div",p,[Object(c["g"])("div",j,[t[3]||(t[3]=Object(c["g"])("div",null,null,-1)),Object(c["g"])("div",O,[Object(c["j"])(s,{to:"/",class:"title-link"},{default:Object(c["H"])(()=>t[1]||(t[1]=[Object(c["g"])("h1",null,"JW Blog",-1),Object(c["g"])("img",{src:b.a,alt:"JW Logo",class:"logo"},null,-1)])),_:1}),t[2]||(t[2]=Object(c["h"])('<div class="social-icons" data-v-d4a30522><a href="https://www.instagram.com/sarsywang" target="_blank" rel="noopener noreferrer" class="social-icon instagram" data-v-d4a30522><i class="fab fa-instagram" data-v-d4a30522></i></a><a href="https://x.com/JiayuWang" target="_blank" rel="noopener noreferrer" class="social-icon twitter" data-v-d4a30522><i class="fab fa-twitter" data-v-d4a30522></i></a><a href="https://www.youtube.com/@tongye" target="_blank" rel="noopener noreferrer" class="social-icon youtube" data-v-d4a30522><i class="fab fa-youtube" data-v-d4a30522></i></a></div>',1))])]),t[11]||(t[11]=Object(c["g"])("hr",null,null,-1)),Object(c["g"])("div",m,[Object(c["g"])("div",v,["Home"!==e.$route.name?(Object(c["v"])(),Object(c["d"])(s,{key:0,to:"/",class:"nav-link"},{default:Object(c["H"])(()=>t[4]||(t[4]=[Object(c["i"])("<< Back to Blog List")])),_:1})):Object(c["e"])("",!0),Object(c["g"])("div",h,[e.hasLogin?(Object(c["v"])(),Object(c["f"])("div",f,[Object(c["g"])("div",y,[Object(c["g"])("button",k,"欢迎, "+Object(c["D"])(e.username)+"!",1),Object(c["g"])("div",w,[t[8]||(t[8]=Object(c["g"])("a",{href:"http://wangjiayu.com",class:"home-link"},"Home",-1)),Object(c["j"])(s,{to:{name:"UserCenter",params:{username:e.username}}},{default:Object(c["H"])(()=>t[5]||(t[5]=[Object(c["i"])("用户中心")])),_:1},8,["to"]),e.isSuperuser?(Object(c["v"])(),Object(c["d"])(s,{key:0,to:{name:"ArticleCreate"}},{default:Object(c["H"])(()=>t[6]||(t[6]=[Object(c["i"])("发表文章")])),_:1})):Object(c["e"])("",!0),Object(c["j"])(s,{to:"/",onClick:t[0]||(t[0]=Object(c["J"])(e=>o.logout(),["prevent"]))},{default:Object(c["H"])(()=>t[7]||(t[7]=[Object(c["i"])("Logout")])),_:1})])])])):(Object(c["v"])(),Object(c["f"])("div",I,[t[10]||(t[10]=Object(c["g"])("a",{href:"http://wangjiayu.com",class:"home-link"},"Home",-1)),Object(c["j"])(s,{to:"/login",class:"login-link"},{default:Object(c["H"])(()=>t[9]||(t[9]=[Object(c["i"])("Login")])),_:1})]))])])])])}var A=a("bc3a"),_=a.n(A);async function D(){const e=localStorage;let t=!1,a=e.getItem("username.myblog");const c=Number(e.getItem("expiredTime.myblog")),n=(new Date).getTime(),r=e.getItem("refresh.myblog");if(c>n)t=!0,console.log("authorization access");else if(null!==r)try{let a=await _.a.post("/api/token/refresh/",{refresh:r});const c=Date.parse(a.headers.date)+6e6;e.setItem("access.myblog",a.data.access),e.setItem("expiredTime.myblog",c),e.removeItem("refresh.myblog"),t=!0,console.log("authorization refresh")}catch(o){e.clear(),t=!1,console.log("authorization err")}else e.clear(),t=!1,console.log("authorization exp");return console.log("authorization done"),[t,a]}var x=D,B={name:"BlogHeader",data:function(){return{username:"",hasLogin:!1,isSuperuser:JSON.parse(localStorage.getItem("isSuperuser.myblog"))}},mounted(){x().then(e=>[this.hasLogin,this.username]=e)},methods:{logout(){localStorage.clear(),window.location.reload(!1)},refresh(){this.username=localStorage.getItem("username.myblog")}}};a("b512"),a("88bb");const S=s()(B,[["render",C],["__scopeId","data-v-d4a30522"]]);var F=S;const T={id:"footer"};function L(e,t,a,n,r,o){return Object(c["v"])(),Object(c["f"])(c["a"],null,[t[0]||(t[0]=Object(c["g"])("br",null,null,-1)),t[1]||(t[1]=Object(c["g"])("br",null,null,-1)),t[2]||(t[2]=Object(c["g"])("br",null,null,-1)),Object(c["g"])("div",T,[Object(c["g"])("p",null,"© 2007 - "+Object(c["D"])(o.currentYear)+" Jiayu Wang. All Rights Reserved.",1)])],64)}var H={name:"BlogFooter",computed:{currentYear(){return(new Date).getFullYear()}}};a("5a96");const U=s()(H,[["render",L],["__scopeId","data-v-2e0cd012"]]);var E=U;const $={class:"page-layout"},q={class:"main-content"},M={key:0,class:"image-container"},R=["src"],P={class:"content-container"},z={key:0,class:"category"},V={class:"a-title-container"},J={key:0,class:"visit-count"},N={class:"article-date"},G={id:"paginator"},W={key:0},Y={class:"current-page"},K={key:1},Q={class:"sidebar"},X={class:"sidebar-section"},Z={class:"sidebar-content"},ee=["onClick"],te={key:0,class:"tag-count"},ae={key:0,class:"empty-message"},ce={class:"sidebar-section"},ne={class:"sidebar-content"},re=["onClick"],oe={key:0,class:"category-count"},se={key:0,class:"empty-message"},le={key:0,class:"sidebar-section visitors-section"},ie={class:"visitors-count"};function ue(e,t,a,n,r,o){const s=Object(c["A"])("router-link");return Object(c["v"])(),Object(c["f"])("div",$,[Object(c["g"])("div",q,[(Object(c["v"])(!0),Object(c["f"])(c["a"],null,Object(c["z"])(n.info.results,e=>(Object(c["v"])(),Object(c["f"])("div",{key:e.url,id:"articles"},[Object(c["g"])("div",{class:"grid",style:Object(c["q"])(n.gridStyle(e))},[n.imageIfExists(e)?(Object(c["v"])(),Object(c["f"])("div",M,[Object(c["j"])(s,{to:{name:"ArticleDetail",params:{id:e.id}}},{default:Object(c["H"])(()=>[Object(c["g"])("img",{src:n.imageIfExists(e),alt:"",class:"image"},null,8,R)]),_:2},1032,["to"])])):Object(c["e"])("",!0),Object(c["g"])("div",P,[Object(c["g"])("div",null,[null!==e.category?(Object(c["v"])(),Object(c["f"])("span",z,Object(c["D"])(e.category.title),1)):Object(c["e"])("",!0),(Object(c["v"])(!0),Object(c["f"])(c["a"],null,Object(c["z"])(e.tags,e=>(Object(c["v"])(),Object(c["f"])("span",{key:e,class:"tag"},Object(c["D"])(e),1))),128))]),Object(c["g"])("div",V,[Object(c["j"])(s,{to:{name:"ArticleDetail",params:{id:e.id}},class:"article-title"},{default:Object(c["H"])(()=>[Object(c["i"])(Object(c["D"])(e.title),1)]),_:2},1032,["to"]),e.visit_count?(Object(c["v"])(),Object(c["f"])("span",J,[t[0]||(t[0]=Object(c["g"])("i",{class:"fas fa-eye"},null,-1)),Object(c["i"])(" "+Object(c["D"])(e.visit_count),1)])):Object(c["e"])("",!0)]),Object(c["g"])("div",N,Object(c["D"])(n.formatted_time(e.created)),1)])],4)]))),128)),Object(c["g"])("div",G,[n.is_page_exists("previous")?(Object(c["v"])(),Object(c["f"])("span",W,[Object(c["j"])(s,{to:n.get_path("previous")},{default:Object(c["H"])(()=>t[1]||(t[1]=[Object(c["i"])(" Prev ")])),_:1},8,["to"])])):Object(c["e"])("",!0),Object(c["g"])("span",Y,Object(c["D"])(n.get_page_param("current")),1),n.is_page_exists("next")?(Object(c["v"])(),Object(c["f"])("span",K,[Object(c["j"])(s,{to:n.get_path("next")},{default:Object(c["H"])(()=>t[2]||(t[2]=[Object(c["i"])(" Next ")])),_:1},8,["to"])])):Object(c["e"])("",!0)])]),Object(c["g"])("div",Q,[Object(c["g"])("div",X,[t[3]||(t[3]=Object(c["g"])("h3",{class:"sidebar-title"},[Object(c["g"])("i",{class:"fas fa-tags"}),Object(c["i"])(" Tags ")],-1)),Object(c["g"])("div",Z,[(Object(c["v"])(!0),Object(c["f"])(c["a"],null,Object(c["z"])(n.recentTags,e=>(Object(c["v"])(),Object(c["f"])("div",{key:e.id,class:Object(c["p"])(["sidebar-tag",{active:n.selectedTag===e.text}]),onClick:t=>n.filterByTag(e.text)},[Object(c["i"])(Object(c["D"])(e.text)+" ",1),e.count?(Object(c["v"])(),Object(c["f"])("span",te,"("+Object(c["D"])(e.count)+")",1)):Object(c["e"])("",!0)],10,ee))),128)),0===n.recentTags.length?(Object(c["v"])(),Object(c["f"])("div",ae," No tags available ")):Object(c["e"])("",!0)])]),Object(c["g"])("div",ce,[t[4]||(t[4]=Object(c["g"])("h3",{class:"sidebar-title"},[Object(c["g"])("i",{class:"fas fa-folder"}),Object(c["i"])(" Categories ")],-1)),Object(c["g"])("div",ne,[(Object(c["v"])(!0),Object(c["f"])(c["a"],null,Object(c["z"])(n.categories,e=>(Object(c["v"])(),Object(c["f"])("div",{key:e.id,class:Object(c["p"])(["sidebar-category",{active:n.selectedCategory===e.id}]),onClick:t=>n.filterByCategory(e.id)},[Object(c["i"])(Object(c["D"])(e.title)+" ",1),e.count?(Object(c["v"])(),Object(c["f"])("span",oe,"("+Object(c["D"])(e.count)+")",1)):Object(c["e"])("",!0)],10,re))),128)),0===n.categories.length?(Object(c["v"])(),Object(c["f"])("div",se," No categories available ")):Object(c["e"])("",!0)])]),n.pageVisitCount?(Object(c["v"])(),Object(c["f"])("div",le,[Object(c["g"])("div",ie,[t[5]||(t[5]=Object(c["g"])("i",{class:"fas fa-glasses"},null,-1)),Object(c["g"])("span",null,"Total Visitors: "+Object(c["D"])(n.pageVisitCount),1)])])):Object(c["e"])("",!0)])])}a("14d9");const ge="/api";function de(e,t,a){const n=async()=>{const c=void 0!==t.query.page?parseInt(t.query.page):1;if(a.value.page===c&&a.value.searchText===t.query.search&&a.value.tag===t.query.tag&&a.value.category===t.query.category)return;let n=ge+"/article/",r=new URLSearchParams;t.query.page&&r.append("page",t.query.page),t.query.search&&r.append("search",t.query.search),t.query.tag&&r.append("tag",t.query.tag),t.query.category&&r.append("category",t.query.category);const o=r.toString();o&&(n+="?"+o);try{console.log("Fetching articles from:",n);const r=await _.a.get(n);console.log("Response:",r.data),e.value=r.data,a.value.page=c,a.value.searchText=t.query.search,a.value.tag=t.query.tag,a.value.category=t.query.category}catch(s){console.error("Error fetching articles:",s),s.response&&(console.error("Response status:",s.response.status),console.error("Response data:",s.response.data))}};Object(c["t"])(n),Object(c["G"])(t,n)}function be(e,t){const a=t=>pe(e,t),c=a=>je(e,t,a),n=t=>Oe(e,t);return{is_page_exists:a,get_page_param:c,get_path:n}}function pe(e,t){return"next"===t?null!==e.value.next:null!==e.value.previous}function je(e,t,a){try{let c;switch(a){case"next":c=e.value.next;break;case"previous":c=e.value.previous;break;default:return t.query.page}const n=new URL(c);return n.searchParams.get("page")}catch(c){return}}function Oe(e,t){let a="";try{switch(t){case"next":void 0!==e.value.next&&(a+=new URL(e.value.next).search);break;case"previous":void 0!==e.value.previous&&(a+=new URL(e.value.previous).search);break}}catch{return a}return a}function me(){const e=e=>ve(e),t=e=>he(e);return{imageIfExists:e,gridStyle:t}}function ve(e){if(e.avatar)return e.avatar.content}function he(e){if(e.avatar)return{display:"grid",gridTemplateColumns:"1fr 4fr"}}function fe(e){const t=new Date(e),a=t.getFullYear(),c=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${a}-${c}-${n}`}var ye={name:"ArticleList",setup(){const e=Object(c["y"])(""),t=Object(u["c"])(),a=Object(u["d"])(),n=Object(c["y"])(0),r=Object(c["y"])([]),o=Object(c["y"])([]),s=Object(c["y"])(null),l=Object(c["y"])(null),i=Object(c["y"])(null),g=Object(c["y"])({page:0,searchText:"",tag:null,category:null});de(e,t,g);const{is_page_exists:d,get_page_param:b,get_path:p}=be(e,t),{imageIfExists:j,gridStyle:O}=me(),m=fe,v=async()=>{try{const e=await _.a.get("/api/tag/");r.value=e.data,i.value=null}catch(i){console.error("Error fetching tags:",i),r.value=[],i.value="Failed to load tags"}},h=async()=>{try{const e=await _.a.get("/api/category/");o.value=e.data,i.value=null}catch(i){console.error("Error fetching categories:",i),o.value=[],i.value="Failed to load categories"}},f=e=>{s.value===e?(s.value=null,a.push({path:t.path,query:{...t.query,tag:void 0,page:void 0}})):(s.value=e,a.push({path:t.path,query:{...t.query,tag:e,page:void 0}}))},y=e=>{l.value===e?(l.value=null,a.push({path:t.path,query:{...t.query,category:void 0,page:void 0}})):(l.value=e,a.push({path:t.path,query:{...t.query,category:e,page:void 0}}))},k=async()=>{try{const e=await _.a.get("/api/visit-count/home/");n.value=e.data.count}catch(i){console.error("Error fetching page visit count:",i),n.value=0}},w=async()=>{if(e.value&&e.value.results)for(let t of e.value.results)try{const e=await _.a.get(`/api/visit-count/article/${t.id}/`);t.visit_count=e.data.count}catch(i){console.error("Error fetching visit count:",i),t.visit_count=0}};return Object(c["G"])(()=>t.query,e=>{s.value=e.tag||null,l.value=e.category?parseInt(e.category):null},{immediate:!0}),Object(c["G"])(()=>e.value,e=>{e&&e.results&&(w(),v(),h())},{immediate:!0}),k(),v(),h(),{info:e,is_page_exists:d,get_page_param:b,get_path:p,imageIfExists:j,gridStyle:O,formatted_time:m,pageVisitCount:n,recentTags:r,categories:o,selectedTag:s,selectedCategory:l,filterByTag:f,filterByCategory:y,error:i}}};a("872e");const ke=s()(ye,[["render",ue],["__scopeId","data-v-b3d1dc30"]]);var we=ke,Ie={name:"Home",components:{BlogHeader:F,BlogFooter:E,ArticleList:we},setup(){const e=Object(c["y"])(0),t=async()=>{try{const t=await _.a.get("/api/visit-count/home/");e.value=t.data.count}catch(t){console.error("Error fetching page visit count:",t),e.value=0}};return Object(c["t"])(()=>{t()}),{pageVisitCount:e}}};a("6a0c");const Ce=s()(Ie,[["render",g],["__scopeId","data-v-50a1b3bc"]]);var Ae=Ce;const _e={key:0,class:"grid-container"},De={id:"title"},xe={id:"subtitle"},Be={key:0},Se=["innerHTML"],Fe={key:0},Te=["innerHTML"],Le={class:"visit-counter"};function He(e,t,a,n,r,o){const s=Object(c["A"])("BlogHeader"),l=Object(c["A"])("router-link"),i=Object(c["A"])("Comments"),u=Object(c["A"])("BlogFooter");return Object(c["v"])(),Object(c["f"])(c["a"],null,[Object(c["j"])(s),null!==e.article?(Object(c["v"])(),Object(c["f"])("div",_e,[Object(c["g"])("div",null,[Object(c["g"])("h1",De,Object(c["D"])(e.article.title),1),Object(c["g"])("p",xe,[Object(c["i"])(" Published on "+Object(c["D"])(o.formatted_time(e.article.created))+" ",1),o.isSuperuser?(Object(c["v"])(),Object(c["f"])("span",Be,[Object(c["j"])(l,{to:{name:"ArticleEdit",params:{id:e.article.id}}},{default:Object(c["H"])(()=>t[0]||(t[0]=[Object(c["i"])("更新与删除")])),_:1},8,["to"])])):Object(c["e"])("",!0)]),Object(c["g"])("div",{innerHTML:e.article.body_html,class:"article-body"},null,8,Se)]),o.hasToc?(Object(c["v"])(),Object(c["f"])("div",Fe,[t[1]||(t[1]=Object(c["g"])("h3",null,"目录",-1)),Object(c["g"])("div",{innerHTML:e.article.toc_html,class:"toc"},null,8,Te)])):Object(c["e"])("",!0)])):Object(c["e"])("",!0),Object(c["j"])(i,{article:e.article},null,8,["article"]),Object(c["g"])("div",Le,[t[2]||(t[2]=Object(c["g"])("i",{class:"fas fa-eye"},null,-1)),Object(c["i"])(" 访问量："+Object(c["D"])(e.visitCount),1)]),Object(c["j"])(u)],64)}a("e9f5"),a("7d54");const Ue=["placeholder"],Ee={class:"comments"},$e={class:"username"},qe={class:"created"},Me={key:0},Re={class:"parent"},Pe={class:"content"},ze=["onClick"];function Ve(e,t,a,n,r,o){return Object(c["v"])(),Object(c["f"])(c["a"],null,[t[6]||(t[6]=Object(c["g"])("br",null,null,-1)),t[7]||(t[7]=Object(c["g"])("br",null,null,-1)),t[8]||(t[8]=Object(c["g"])("hr",null,null,-1)),t[9]||(t[9]=Object(c["g"])("h3",null,"发表评论",-1)),Object(c["I"])(Object(c["g"])("textarea",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.message=t),placeholder:e.placeholder,name:"comment",id:"comment-area",cols:"60",rows:"10"},null,8,Ue),[[c["F"],e.message]]),Object(c["g"])("div",null,[Object(c["g"])("button",{onClick:t[1]||(t[1]=(...e)=>o.submit&&o.submit(...e)),class:"submitBtn"},"发布")]),t[10]||(t[10]=Object(c["g"])("br",null,null,-1)),Object(c["g"])("p",null,Object(c["D"])(e.comments.length)+" comment"+Object(c["D"])(1!==e.comments.length?"s":""),1),t[11]||(t[11]=Object(c["g"])("hr",null,null,-1)),(Object(c["v"])(!0),Object(c["f"])(c["a"],null,Object(c["z"])(e.comments,e=>(Object(c["v"])(),Object(c["f"])("div",{key:e.id},[Object(c["g"])("div",Ee,[Object(c["g"])("div",null,[Object(c["g"])("span",$e,Object(c["D"])(e.author.username),1),t[3]||(t[3]=Object(c["i"])(" 于 ")),Object(c["g"])("span",qe,Object(c["D"])(o.formatted_time(e.created)),1),e.parent?(Object(c["v"])(),Object(c["f"])("span",Me,[t[2]||(t[2]=Object(c["i"])(" 对 ")),Object(c["g"])("span",Re,Object(c["D"])(e.parent.author.username),1)])):Object(c["e"])("",!0),t[4]||(t[4]=Object(c["i"])(" 说道： "))]),Object(c["g"])("div",Pe,Object(c["D"])(e.content),1),Object(c["g"])("div",null,[Object(c["g"])("button",{class:"commentBtn",onClick:t=>o.replyTo(e)},"回复",8,ze)])]),t[5]||(t[5]=Object(c["g"])("hr",null,null,-1))]))),128))],64)}var Je={name:"Comments",props:{article:Object},data:function(){return{comments:[],message:"",placeholder:"说点啥吧...",parentID:null}},watch:{article(){this.comments=null!==this.article?this.article.comments:[]}},methods:{submit(){const e=this;x().then((function(t){t[0]?_.a.post("/api/comment/",{content:e.message,article_id:e.article.id,parent_id:e.parentID},{headers:{Authorization:"Bearer "+localStorage.getItem("access.myblog")}}).then((function(t){e.comments.unshift(t.data),e.message="",alert("留言成功")})):alert("请登录后评论。")}))},replyTo(e){this.parentID=e.id,this.placeholder="对"+e.author.username+"说:"},formatted_time:function(e){const t=new Date(e);return t.toLocaleDateString()+"  "+t.toLocaleTimeString()}}};a("927c");const Ne=s()(Je,[["render",Ve],["__scopeId","data-v-c0aacb24"]]);var Ge=Ne,We=a("1487"),Ye=a.n(We),Ke=(a("9f21"),{name:"ArticleDetail",components:{BlogHeader:F,BlogFooter:E,Comments:Ge},data:function(){return{article:null,hasLogin:!1,visitCount:0}},mounted(){x().then(e=>[this.hasLogin,this.username]=e),_.a.get("/api/article/"+this.$route.params.id).then(e=>{this.article=e.data,this.$nextTick(()=>{document.querySelectorAll("pre code").forEach(e=>{Ye.a.highlightBlock(e)})})}),this.getVisitCount()},methods:{formatted_time:function(e){const t=new Date(e);return t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})},getVisitCount(){const e=this.$route.params.id;console.log("Fetching visit count for article:",e),_.a.get(`/api/visit-count/article/${e}/`).then(e=>{console.log("Visit count response:",e.data),this.visitCount=e.data.count}).catch(e=>{console.error("Error fetching visit count:",e),console.error("Error details:",e.response),this.visitCount=0})}},computed:{isSuperuser(){return"true"===localStorage.getItem("isSuperuser.myblog")},hasToc(){if(!this.article||!this.article.toc_html)return!1;const e=this.article.toc_html.replace(/<[^>]+>/g,"").trim();return e.length>0}}});a("78fe"),a("a96c");const Qe=s()(Ke,[["render",He],["__scopeId","data-v-141212f3"]]);var Xe=Qe;const Ze={id:"grid"},et={id:"signin"},tt={class:"form-elem"},at={class:"form-elem"},ct={class:"form-elem"};function nt(e,t,a,n,r,o){const s=Object(c["A"])("BlogHeader"),l=Object(c["A"])("BlogFooter");return Object(c["v"])(),Object(c["f"])(c["a"],null,[Object(c["j"])(s),Object(c["g"])("div",Ze,[Object(c["g"])("div",et,[t[5]||(t[5]=Object(c["g"])("h3",null,"登录账号",-1)),Object(c["g"])("form",null,[Object(c["g"])("div",tt,[t[3]||(t[3]=Object(c["g"])("span",null,"账号：",-1)),Object(c["I"])(Object(c["g"])("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.signinName=t),type:"text",placeholder:"输入用户名"},null,512),[[c["F"],e.signinName]])]),Object(c["g"])("div",at,[t[4]||(t[4]=Object(c["g"])("span",null,"密码：",-1)),Object(c["I"])(Object(c["g"])("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.signinPwd=t),type:"password",placeholder:"输入密码"},null,512),[[c["F"],e.signinPwd]])]),Object(c["g"])("div",ct,[Object(c["g"])("button",{onClick:t[2]||(t[2]=Object(c["J"])((...e)=>o.signin&&o.signin(...e),["prevent"]))},"登录")])])])]),Object(c["j"])(l)],64)}var rt={name:"Login",components:{BlogHeader:F,BlogFooter:E},data:function(){return{signupName:"",signupPwd:"",signinName:"",signinPwd:"",signupResponse:null}},methods:{signup(){const e=this;_.a.post("/api/user/",{username:this.signupName,password:this.signupPwd}).then((function(t){e.signupResponse=t.data,alert("用户注册成功，快去登录吧！")})).catch((function(e){alert(e.message)}))},signin(){const e=this;_.a.post("/api/token/",{username:e.signinName,password:e.signinPwd}).then((function(t){const a=localStorage,c=Date.parse(t.headers.date)+6e6;a.setItem("access.myblog",t.data.access),a.setItem("refresh.myblog",t.data.refresh),a.setItem("expiredTime.myblog",c),a.setItem("username.myblog",e.signinName),_.a.get("/api/user/"+e.signinName+"/").then((function(t){a.setItem("isSuperuser.myblog",t.data.is_superuser),e.$router.push({name:"Home"})}))}))}}};a("5c74");const ot=s()(rt,[["render",nt],["__scopeId","data-v-d1d7f986"]]);var st=ot;const lt={id:"user-center"},it={class:"form-elem"},ut={class:"form-elem"},gt={class:"form-elem"},dt={class:"form-elem"};function bt(e,t,a,n,r,o){const s=Object(c["A"])("BlogHeader"),l=Object(c["A"])("BlogFooter");return Object(c["v"])(),Object(c["f"])(c["a"],null,[Object(c["j"])(s,{ref:"header"},null,512),Object(c["g"])("div",lt,[t[7]||(t[7]=Object(c["g"])("h3",null,"更新资料信息",-1)),Object(c["g"])("form",null,[Object(c["g"])("div",it,[t[5]||(t[5]=Object(c["g"])("span",null,"用户名：",-1)),Object(c["I"])(Object(c["g"])("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.username=t),type:"text",placeholder:"输入用户名"},null,512),[[c["F"],e.username]])]),Object(c["g"])("div",ut,[t[6]||(t[6]=Object(c["g"])("span",null,"新密码：",-1)),Object(c["I"])(Object(c["g"])("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.password=t),type:"password",placeholder:"输入密码"},null,512),[[c["F"],e.password]])]),Object(c["g"])("div",gt,[Object(c["g"])("button",{onClick:t[2]||(t[2]=Object(c["J"])((...e)=>o.changeInfo&&o.changeInfo(...e),["prevent"]))},"更新")]),Object(c["g"])("div",dt,[Object(c["g"])("button",{onClick:t[3]||(t[3]=Object(c["J"])(t=>e.showingDeleteAlert=!0,["prevent"])),class:"delete-btn"},"删除用户"),Object(c["g"])("div",{class:Object(c["p"])({shake:e.showingDeleteAlert})},[e.showingDeleteAlert?(Object(c["v"])(),Object(c["f"])("button",{key:0,class:"confirm-btn",onClick:t[4]||(t[4]=Object(c["J"])((...e)=>o.confirmDelete&&o.confirmDelete(...e),["prevent"]))},"确定？ ")):Object(c["e"])("",!0)],2)])])]),Object(c["j"])(l)],64)}const pt=localStorage;var jt={name:"UserCenter",components:{BlogHeader:F,BlogFooter:E},data:function(){return{username:"",password:"",token:"",showingDeleteAlert:!1}},mounted(){this.username=pt.getItem("username.myblog")},methods:{confirmDelete(){const e=this;x().then((function(t){t[0]&&(e.token=pt.getItem("access.myblog"),_.a.delete("/api/user/"+e.username+"/",{headers:{Authorization:"Bearer "+e.token}}).then((function(){pt.clear(),e.$router.push({name:"Home"})})))}))},changeInfo(){const e=this;x().then((function(t){if(!t[0])return void alert("登录已过期，请重新登录");if(console.log("change info start"),e.password.length>0&&e.password.length<6)return void alert("Password too short.");const a=pt.getItem("username.myblog");let c={};""!==e.username&&(c.username=e.username),""!==e.password&&(c.password=e.password),e.token=pt.getItem("access.myblog"),_.a.patch("/api/user/"+a+"/",c,{headers:{Authorization:"Bearer "+e.token}}).then((function(t){const a=t.data.username;pt.setItem("username.myblog",a),e.$router.push({name:"UserCenter",params:{username:a}}),e.$refs.header.refresh()}))}))}}};a("8783"),a("036b");const Ot=s()(jt,[["render",bt],["__scopeId","data-v-63d076bb"]]);var mt=Ot;const vt={id:"article-create"},ht={class:"image-upload-section"},ft={class:"upload-container"},yt={key:0,class:"preview-container"},kt=["src"],wt={class:"markdown-link"},It={class:"link-container"},Ct={class:"image-upload-section"},At={class:"upload-container"},_t={key:0,class:"preview-container"},Dt=["src"],xt={class:"markdown-link"},Bt={class:"link-container"},St={class:"form-elem"},Ft={class:"form-elem"},Tt=["onClick"],Lt={class:"form-elem"},Ht={class:"form-elem"},Ut={class:"editor-wrapper",ref:"editorRoot"},Et={class:"form-elem"};function $t(e,t,a,n,r,o){const s=Object(c["A"])("BlogHeader"),l=Object(c["A"])("Editor"),i=Object(c["A"])("BlogFooter");return Object(c["v"])(),Object(c["f"])(c["a"],null,[Object(c["j"])(s),Object(c["g"])("div",vt,[t[18]||(t[18]=Object(c["g"])("h3",null,"发表文章",-1)),Object(c["g"])("div",ht,[t[11]||(t[11]=Object(c["g"])("h4",null,"文章封面图",-1)),Object(c["g"])("div",ft,[Object(c["g"])("input",{type:"file",onChange:t[0]||(t[0]=(...e)=>o.onAvatarChange&&o.onAvatarChange(...e)),accept:"image/*",ref:"avatarInput",style:{display:"none"}},null,544),Object(c["g"])("button",{onClick:t[1]||(t[1]=(...e)=>o.triggerAvatarInput&&o.triggerAvatarInput(...e)),class:"upload-btn"}," 选择封面图 "),e.currentAvatar?(Object(c["v"])(),Object(c["f"])("div",yt,[Object(c["g"])("img",{src:e.currentAvatar,alt:"Current Avatar",class:"preview-image"},null,8,kt),Object(c["g"])("div",wt,[t[10]||(t[10]=Object(c["g"])("p",null,"当前封面图链接：",-1)),Object(c["g"])("div",It,[Object(c["g"])("code",null,"![avatar]("+Object(c["D"])(e.currentAvatar)+")",1),Object(c["g"])("button",{onClick:t[2]||(t[2]=(...e)=>o.copyAvatarLink&&o.copyAvatarLink(...e)),class:"copy-btn"},"复制")])])])):Object(c["e"])("",!0)])]),Object(c["g"])("div",Ct,[t[13]||(t[13]=Object(c["g"])("h4",null,"上传图片",-1)),Object(c["g"])("div",At,[Object(c["g"])("input",{type:"file",onChange:t[3]||(t[3]=(...e)=>o.onImageChange&&o.onImageChange(...e)),accept:"image/*",ref:"fileInput",style:{display:"none"}},null,544),Object(c["g"])("button",{onClick:t[4]||(t[4]=(...e)=>o.triggerFileInput&&o.triggerFileInput(...e)),class:"upload-btn"},"选择图片"),e.uploadedImageUrl?(Object(c["v"])(),Object(c["f"])("div",_t,[Object(c["g"])("img",{src:e.uploadedImageUrl,alt:"Preview",class:"preview-image"},null,8,Dt),Object(c["g"])("div",xt,[t[12]||(t[12]=Object(c["g"])("p",null,"Markdown链接：",-1)),Object(c["g"])("div",Bt,[Object(c["g"])("code",null,"![image]("+Object(c["D"])(e.uploadedImageUrl)+")",1),Object(c["g"])("button",{onClick:t[5]||(t[5]=(...e)=>o.copyMarkdownLink&&o.copyMarkdownLink(...e)),class:"copy-btn"},"复制")])])])):Object(c["e"])("",!0)])]),Object(c["g"])("form",null,[Object(c["g"])("div",St,[t[14]||(t[14]=Object(c["g"])("span",null,"标题：",-1)),Object(c["I"])(Object(c["g"])("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.title=t),type:"text",placeholder:"输入标题"},null,512),[[c["F"],e.title]])]),Object(c["g"])("div",Ft,[t[15]||(t[15]=Object(c["g"])("span",null,"分类：",-1)),(Object(c["v"])(!0),Object(c["f"])(c["a"],null,Object(c["z"])(e.categories,e=>(Object(c["v"])(),Object(c["f"])("span",{key:e.id},[Object(c["g"])("button",{class:"category-btn",style:Object(c["q"])(o.categoryStyle(e)),onClick:Object(c["J"])(t=>o.chooseCategory(e),["prevent"])},Object(c["D"])(e.title),13,Tt)]))),128))]),Object(c["g"])("div",Lt,[t[16]||(t[16]=Object(c["g"])("span",null,"标签：",-1)),Object(c["I"])(Object(c["g"])("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.tags=t),type:"text",placeholder:"输入标签，用逗号分隔"},null,512),[[c["F"],e.tags]])]),Object(c["g"])("div",Ht,[t[17]||(t[17]=Object(c["g"])("span",null,"正文：",-1)),Object(c["g"])("div",Ut,[Object(c["j"])(l,{modelValue:e.body,"onUpdate:modelValue":t[8]||(t[8]=t=>e.body=t),initialValue:e.body,options:{height:"500px",initialEditType:"markdown",previewStyle:"vertical",toolbarItems:[["heading","bold","italic","strike"],["hr","quote"],["ul","ol","task","indent","outdent"],["table","image","link"],["code","codeblock"]]},onChange:o.handleEditorChange},null,8,["modelValue","initialValue","onChange"])],512)]),Object(c["g"])("div",Et,[Object(c["g"])("button",{onClick:t[9]||(t[9]=Object(c["J"])((...e)=>o.submit&&o.submit(...e),["prevent"]))},"提交")])])]),Object(c["j"])(i)],64)}a("910d"),a("ab43"),a("f513");var qt=a("5865");const Mt="/api";var Rt={name:"ArticleCreate",components:{BlogHeader:F,BlogFooter:E},data:function(){return{title:"",body:"",categories:[],selectedCategory:null,tags:"",avatarID:null,uploadedImageUrl:"",currentAvatar:"",editor:null}},mounted(){_.a.get(Mt+"/category/").then(e=>this.categories=e.data).catch(e=>{console.error("Error fetching categories:",e),e.response&&(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data))}),this.$nextTick(()=>{this.editor=new qt["a"]({el:this.$refs.editorRoot,height:"500px",initialEditType:"markdown",previewStyle:"vertical",initialValue:this.body,toolbarItems:[["heading","bold","italic","strike"],["hr","quote"],["ul","ol","task","indent","outdent"],["table","image","link"],["code","codeblock"]],hooks:{addImageBlobHook:async(e,t)=>{try{const a=new FileReader;a.onload=function(a){const c=a.target.result;console.log("Base64 image data:",c.substring(0,100)+"..."),t(c,e.name)},a.readAsDataURL(e)}catch(a){console.error("Error processing image:",a),alert("图片处理失败，请重试")}}}}),this.editor.on("change",()=>{this.body=this.editor.getMarkdown()})})},beforeUnmount(){this.editor&&this.editor.destroy()},methods:{triggerFileInput(){this.$refs.fileInput.click()},triggerAvatarInput(){this.$refs.avatarInput.click()},onImageChange(e){const t=e.target.files[0];if(!t)return;const a=["image/jpeg","image/png","image/gif"];if(!a.includes(t.type))return void alert("只支持 JPG、PNG 和 GIF 格式的图片");const c=5242880;if(t.size>c)return void alert("文件大小不能超过 5MB");const n=new FormData;n.append("content",t),_.a.post(Mt+"/avatar/",n,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("access.myblog")}}).then(e=>{this.uploadedImageUrl=e.data.content}).catch(e=>{console.error("Error uploading image:",e),e.response&&(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data)),alert("图片上传失败，请重试")})},copyMarkdownLink(){const e=`![image](${this.uploadedImageUrl})`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>alert("Markdown链接已复制到剪贴板")).catch(t=>{console.error("复制失败:",t),this.fallbackCopy(e)}):this.fallbackCopy(e)},fallbackCopy(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy"),alert("Markdown链接已复制到剪贴板")}catch(a){console.error("复制失败:",a),alert("复制失败，请手动复制链接")}document.body.removeChild(t)},onAvatarChange(e){const t=e.target.files[0];if(!t)return;const a=["image/jpeg","image/png","image/gif"];if(!a.includes(t.type))return void alert("只支持 JPG、PNG 和 GIF 格式的图片");const c=5242880;if(t.size>c)return void alert("文件大小不能超过 5MB");const n=new FormData;n.append("content",t),_.a.post(Mt+"/avatar/",n,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("access.myblog")}}).then(e=>{this.currentAvatar=e.data.content,this.avatarID=e.data.id}).catch(e=>{console.error("Error uploading avatar:",e),e.response&&(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data)),alert("封面图上传失败，请重试")})},copyAvatarLink(){const e=`![avatar](${this.currentAvatar})`;navigator.clipboard.writeText(e).then(()=>alert("封面图链接已复制到剪贴板")).catch(e=>console.error("复制失败:",e))},categoryStyle(e){return null!==this.selectedCategory&&e.id===this.selectedCategory.id?{backgroundColor:"black"}:{backgroundColor:"lightgrey",color:"black"}},chooseCategory(e){this.selectedCategory=e},handleEditorChange(){this.editor&&(this.body=this.editor.getMarkdown())},submit(){const e=this;this.handleEditorChange(),x().then((function(t){if(t[0]){let t={title:e.title,body:e.body};t.avatar_id=e.avatarID,e.selectedCategory&&(t.category_id=e.selectedCategory.id),t.tags=e.tags.split(/[,，]/).map(e=>e.trim()).filter(e=>""!==e.charAt(0));const a=localStorage.getItem("access.myblog");_.a.post(Mt+"/article/",t,{headers:{Authorization:"Bearer "+a}}).then((function(t){e.$router.push({name:"ArticleDetail",params:{id:t.data.id}})})).catch(e=>{console.error("Error creating article:",e),e.response&&(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data)),alert("创建文章失败，请重试")})}else alert("令牌过期，请重新登录。")}))}}};a("b3a4");const Pt=s()(Rt,[["render",$t],["__scopeId","data-v-6733b894"]]);var zt=Pt;const Vt={id:"article-create"},Jt={class:"image-upload-section"},Nt={class:"upload-container"},Gt={key:0,class:"preview-container"},Wt=["src"],Yt={class:"markdown-link"},Kt={class:"link-container"},Qt={class:"image-upload-section"},Xt={class:"upload-container"},Zt={key:0,class:"preview-container"},ea=["src"],ta={class:"markdown-link"},aa={class:"link-container"},ca={class:"form-elem"},na={class:"form-elem"},ra=["onClick"],oa={class:"form-elem"},sa={class:"form-elem"},la={class:"editor-container",ref:"editorRoot"},ia={class:"preview-container"},ua={class:"form-elem"},ga={class:"form-elem"};function da(e,t,a,n,r,o){const s=Object(c["A"])("BlogHeader"),l=Object(c["A"])("Markdown"),i=Object(c["A"])("BlogFooter");return Object(c["v"])(),Object(c["f"])(c["a"],null,[Object(c["j"])(s),Object(c["g"])("div",Vt,[t[21]||(t[21]=Object(c["g"])("h3",null,"更新文章",-1)),Object(c["g"])("div",Jt,[t[13]||(t[13]=Object(c["g"])("h4",null,"文章封面图",-1)),Object(c["g"])("div",Nt,[Object(c["g"])("input",{type:"file",onChange:t[0]||(t[0]=(...e)=>o.onAvatarChange&&o.onAvatarChange(...e)),accept:"image/*",ref:"avatarInput",style:{display:"none"}},null,544),Object(c["g"])("button",{onClick:t[1]||(t[1]=(...e)=>o.triggerAvatarInput&&o.triggerAvatarInput(...e)),class:"upload-btn"},"选择封面图"),e.currentAvatar?(Object(c["v"])(),Object(c["f"])("div",Gt,[Object(c["g"])("img",{src:e.currentAvatar,alt:"Current Avatar",class:"preview-image"},null,8,Wt),Object(c["g"])("div",Yt,[t[12]||(t[12]=Object(c["g"])("p",null,"当前封面图链接：",-1)),Object(c["g"])("div",Kt,[Object(c["g"])("code",null,"![avatar]("+Object(c["D"])(e.currentAvatar)+")",1),Object(c["g"])("button",{onClick:t[2]||(t[2]=(...e)=>o.copyAvatarLink&&o.copyAvatarLink(...e)),class:"copy-btn"},"复制")])])])):Object(c["e"])("",!0)])]),Object(c["g"])("div",Qt,[t[15]||(t[15]=Object(c["g"])("h4",null,"上传图片",-1)),Object(c["g"])("div",Xt,[Object(c["g"])("input",{type:"file",onChange:t[3]||(t[3]=(...e)=>o.onImageChange&&o.onImageChange(...e)),accept:"image/*",ref:"fileInput",style:{display:"none"}},null,544),Object(c["g"])("button",{onClick:t[4]||(t[4]=(...e)=>o.triggerFileInput&&o.triggerFileInput(...e)),class:"upload-btn"},"选择图片"),e.uploadedImageUrl?(Object(c["v"])(),Object(c["f"])("div",Zt,[Object(c["g"])("img",{src:e.uploadedImageUrl,alt:"Preview",class:"preview-image"},null,8,ea),Object(c["g"])("div",ta,[t[14]||(t[14]=Object(c["g"])("p",null,"Markdown链接：",-1)),Object(c["g"])("div",aa,[Object(c["g"])("code",null,"![image]("+Object(c["D"])(e.uploadedImageUrl)+")",1),Object(c["g"])("button",{onClick:t[5]||(t[5]=(...e)=>o.copyMarkdownLink&&o.copyMarkdownLink(...e)),class:"copy-btn"},"复制")])])])):Object(c["e"])("",!0)])]),Object(c["g"])("form",null,[Object(c["g"])("div",ca,[t[16]||(t[16]=Object(c["g"])("span",null,"标题：",-1)),Object(c["I"])(Object(c["g"])("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.title=t),type:"text",placeholder:"输入标题"},null,512),[[c["F"],e.title]])]),Object(c["g"])("div",na,[t[17]||(t[17]=Object(c["g"])("span",null,"分类：",-1)),(Object(c["v"])(!0),Object(c["f"])(c["a"],null,Object(c["z"])(e.categories,e=>(Object(c["v"])(),Object(c["f"])("span",{key:e.id},[Object(c["g"])("button",{class:"category-btn",style:Object(c["q"])(o.categoryStyle(e)),onClick:Object(c["J"])(t=>o.chooseCategory(e),["prevent"])},Object(c["D"])(e.title),13,ra)]))),128))]),Object(c["g"])("div",oa,[t[18]||(t[18]=Object(c["g"])("span",null,"标签：",-1)),Object(c["I"])(Object(c["g"])("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.tags=t),type:"text",placeholder:"输入标签，用逗号分隔"},null,512),[[c["F"],e.tags]])]),Object(c["g"])("div",sa,[t[20]||(t[20]=Object(c["g"])("span",null,"正文：",-1)),Object(c["g"])("div",la,[Object(c["I"])(Object(c["g"])("textarea",{"onUpdate:modelValue":t[8]||(t[8]=t=>e.body=t),class:"markdown-editor",placeholder:"输入正文",onInput:t[9]||(t[9]=(...e)=>o.handleInput&&o.handleInput(...e))},null,544),[[c["F"],e.body]]),Object(c["g"])("div",ia,[t[19]||(t[19]=Object(c["g"])("h3",null,"预览",-1)),Object(c["j"])(l,{source:e.body},null,8,["source"])])],512)]),Object(c["g"])("div",ua,[Object(c["g"])("button",{onClick:t[10]||(t[10]=Object(c["J"])((...e)=>o.submit&&o.submit(...e),["prevent"]))},"提交")]),Object(c["g"])("div",ga,[Object(c["g"])("button",{onClick:t[11]||(t[11]=Object(c["J"])((...e)=>o.deleteArticle&&o.deleteArticle(...e),["prevent"])),style:{"background-color":"darkred"}},"删除")])])]),Object(c["j"])(i)],64)}var ba=a("679f");const pa="/api";var ja={name:"ArticleEdit",components:{BlogHeader:F,BlogFooter:E,Markdown:ba["Markdown"]},data:function(){return{title:"",body:"",categories:[],selectedCategory:null,tags:"",articleID:null,uploadedImageUrl:"",currentAvatar:"",avatarID:null,editor:null}},mounted(){_.a.get(pa+"/category/").then(e=>this.categories=e.data);const e=this;_.a.get(`${pa}/article/${e.$route.params.id}/`).then((function(t){const a=t.data;e.title=a.title,e.body=a.body,e.selectedCategory=a.category,e.tags=a.tags.join(","),e.articleID=a.id,a.avatar&&(e.currentAvatar=a.avatar.content,e.avatarID=a.avatar.id),e.$nextTick(()=>{e.editor=new qt["a"]({el:e.$refs.editorRoot,height:"500px",initialEditType:"markdown",previewStyle:"vertical",initialValue:e.body,toolbarItems:[["heading","bold","italic","strike"],["hr","quote"],["ul","ol","task","indent","outdent"],["table","image","link"],["code","codeblock"]],hooks:{addImageBlobHook:async(e,t)=>{try{const a=new FileReader;a.onload=function(a){const c=a.target.result;console.log("Base64 image data:",c.substring(0,100)+"..."),t(c,e.name)},a.readAsDataURL(e)}catch(a){console.error("Error processing image:",a),alert("图片处理失败，请重试")}}}}),e.editor.on("change",()=>{e.body=e.editor.getMarkdown()})})}))},beforeUnmount(){this.editor&&this.editor.destroy()},methods:{triggerAvatarInput(){this.$refs.avatarInput.click()},onAvatarChange(e){const t=e.target.files[0];if(!t)return;const a=["image/jpeg","image/png","image/gif"];if(!a.includes(t.type))return void alert("只支持 JPG、PNG 和 GIF 格式的图片");const c=5242880;if(t.size>c)return void alert("文件大小不能超过 5MB");const n=new FormData;n.append("content",t),_.a.post(pa+"/avatar/",n,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("access.myblog")}}).then(e=>{this.currentAvatar=e.data.content,this.avatarID=e.data.id}).catch(e=>{console.error("Error uploading avatar:",e),e.response&&(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data)),alert("封面图上传失败，请重试")})},copyAvatarLink(){const e=`![avatar](${this.currentAvatar})`;navigator.clipboard.writeText(e).then(()=>alert("封面图链接已复制到剪贴板")).catch(e=>console.error("复制失败:",e))},triggerFileInput(){this.$refs.fileInput.click()},onImageChange(e){const t=e.target.files[0];if(!t)return;const a=["image/jpeg","image/png","image/gif"];if(!a.includes(t.type))return void alert("只支持 JPG、PNG 和 GIF 格式的图片");const c=5242880;if(t.size>c)return void alert("文件大小不能超过 5MB");const n=new FormData;n.append("content",t),_.a.post(pa+"/avatar/",n,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("access.myblog")}}).then(e=>{this.uploadedImageUrl=e.data.content}).catch(e=>{console.error("Error uploading image:",e),e.response&&(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data)),alert("图片上传失败，请重试")})},copyMarkdownLink(){const e=`![image](${this.uploadedImageUrl})`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>alert("Markdown链接已复制到剪贴板")).catch(t=>{console.error("复制失败:",t),this.fallbackCopy(e)}):this.fallbackCopy(e)},fallbackCopy(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy"),alert("Markdown链接已复制到剪贴板")}catch(a){console.error("复制失败:",a),alert("复制失败，请手动复制链接")}document.body.removeChild(t)},categoryStyle(e){return null!==this.selectedCategory&&e.id===this.selectedCategory.id?{backgroundColor:"black"}:{backgroundColor:"lightgrey",color:"black"}},chooseCategory(e){null!==this.selectedCategory&&this.selectedCategory.id===e.id?this.selectedCategory=null:this.selectedCategory=e},submit(){const e=this;x().then((function(t){if(t[0]){let t={title:e.title,body:e.body};e.avatarID&&(t.avatar_id=e.avatarID),t.category_id=e.selectedCategory?e.selectedCategory.id:null,t.tags=e.tags.split(/[,，]/).map(e=>e.trim()).filter(e=>""!==e.charAt(0));const a=localStorage.getItem("access.myblog");_.a.put(`${pa}/article/${e.articleID}/`,t,{headers:{Authorization:"Bearer "+a}}).then((function(t){e.$router.push({name:"ArticleDetail",params:{id:t.data.id}})}))}else alert("令牌过期，请重新登录。")}))},deleteArticle(){const e=this,t=localStorage.getItem("access.myblog");x().then((function(a){a[0]?_.a.delete(`${pa}/article/${e.articleID}/`,{headers:{Authorization:"Bearer "+t}}).then(()=>e.$router.push({name:"Home"})):alert("令牌过期，请重新登录。")}))},handleInput(e){this.body=e.target.value},handleEditorChange(){this.editor&&(this.body=this.editor.getMarkdown())}}};a("68ad");const Oa=s()(ja,[["render",da],["__scopeId","data-v-3afcca7c"]]);var ma=Oa;const va=[{path:"/",name:"Home",component:Ae},{path:"/article/:id",name:"ArticleDetail",component:Xe},{path:"/login",name:"Login",component:st},{path:"/user/:username",name:"UserCenter",component:mt},{path:"/article/create",name:"ArticleCreate",component:zt},{path:"/article/edit/:id",name:"ArticleEdit",component:ma}],ha=Object(u["a"])({history:Object(u["b"])("/blog/"),routes:va});var fa=ha;URLSearchParams.prototype.appendIfExists=function(e,t){null!==t&&void 0!==t&&this.append(e,t)};const ya=Object(c["c"])(i);ya.config.globalProperties.$axios=_.a,ya.use(fa).mount("#app")},"5a96":function(e,t,a){"use strict";a("4076")},"5c74":function(e,t,a){"use strict";a("a3b4")},"68ad":function(e,t,a){"use strict";a("3895")},"6a0c":function(e,t,a){"use strict";a("c7fe")},"70db":function(e,t,a){},"766b":function(e,t,a){},"77b0":function(e,t,a){},"77b7":function(e,t,a){},"78fe":function(e,t,a){"use strict";a("2a28")},"79d1":function(e,t,a){},"872e":function(e,t,a){"use strict";a("766b")},8783:function(e,t,a){"use strict";a("a573")},"88bb":function(e,t,a){"use strict";a("c27c")},"927c":function(e,t,a){"use strict";a("343b")},a3b4:function(e,t,a){},a573:function(e,t,a){},a96c:function(e,t,a){"use strict";a("77b0")},b3a4:function(e,t,a){"use strict";a("79d1")},b512:function(e,t,a){"use strict";a("e743")},c27c:function(e,t,a){},c7fe:function(e,t,a){},ddf2:function(e,t,a){e.exports=a.p+"img/jwlogo2sm.57eed13d.png"},e743:function(e,t,a){},fa19:function(e,t,a){"use strict";a("70db")}});